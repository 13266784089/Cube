var app=require("app"),BrowserWindow=require("browser-window"),ipc=require("ipc"),Storage=require("./libs/Storage"),st=new Storage;global.config=st.get("config")||{};var mapping=require("./libs/Mapping"),__=require("./libs/Utils"),async=require("async");require("crash-reporter").start();var win=null,loadSrc=function(){function n(n,e){return n?void(win.webContents&&win.webContents.send("entry-error",n)):(e&&__.isArray(e)&&e.length&&(this.entryList=e),console.log("entryList",e),void(win.webContents&&win.webContents.send("entry-loaded",this)))}function e(){console.log("source loaded")}function i(i,o){var r=[];r=i?Object.keys(i).filter(function(n){return n in mapping&&i[n]}):Object.keys(mapping),console.log(i,mapping,r),win.webContents&&win.webContents.send("loading-source",r),async.each(r,function(e,i){console.log(e,__.inspect(mapping[e].loader)),mapping[e].loader(n.bind(mapping[e])),i(null)},function(){e(),o(null)})}var o=!1,r=new __.queue;return function(n){r.push(n),o||(o=!0,async.whilst(function(){return!r.empty()},function(n){i(r.pop(),n)},function(n){o=!1}))}}();app.on("window-all-closed",function(){"darwin"!=process.platform&&app.quit()}),app.on("ready",function(){win=new BrowserWindow({width:1200,height:600}),loadSrc(),win.loadUrl("file://"+__dirname+"/index.html"),win.setMenu(null),win.openDevTools(),win.on("closed",function(){win=null})});